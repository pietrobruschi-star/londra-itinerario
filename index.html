<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>üó∫Ô∏è Londra Itinerario Mobile ‚úÖ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0056b3">
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  
  <style>
    * { box-sizing: border-box; }
    body { 
      margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      height: 100vh; overflow: hidden; background: #f0f4f8;
    }
    
    /* üîß VERTICALE OTTIMIZZATO */
    .container { display: flex; flex-direction: column; height: 100vh; }
    #sidebar { 
      background: white; border-bottom: 1px solid #e0e6ed; 
      overflow-y: auto; padding: 12px; 
      max-height: 35vh; min-height: 35vh;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
    }
    
    /* ‚úÖ PULSANTE CHIUDI SOPRA MAPPA */
    #close-sidebar { 
      position: absolute; top: 12px; right: 12px; z-index: 1002;
      background: #ef4444; color: white; border: none; 
      width: 40px; height: 40px; border-radius: 50%; 
      font-size: 16px; cursor: pointer;
    }
    
    #map { flex: 1; min-height: 65vh; }
    
    /* ‚ò∞ HAMBURGER IN ALTO */
    #menu-toggle { 
      position: fixed; top: 12px; left: 12px; z-index: 1001; 
      background: #0056b3; color: white; border: none; 
      width: 48px; height: 48px; border-radius: 50%; 
      font-size: 18px; cursor: pointer; box-shadow: 0 4px 12px rgba(0,86,179,0.4);
    }
    
    h2 { font-size: 1.1rem; margin: 0 0 12px 0; color: #1a1a1a; }
    h3 { 
      font-size: 0.95rem; color: #0056b3; cursor: pointer; margin: 10px 0 6px 0; 
      padding: 6px 8px; border-radius: 6px; font-weight: 600;
    }
    h3:hover, h3.active { background: rgba(0,86,179,0.1); }
    
    .day { border-left: 3px solid; padding-left: 6px; margin-bottom: 16px; }
    .day-Venerdi { border-left-color: #0056b3; } 
    .day-Sabato { border-left-color: #e65100; } 
    .day-Domenica { border-left-color: #2e7d32; } 
    .day-Lunedi { border-left-color: #6a1b9a; } 
    
    .stop { 
      font-size: 0.8rem; margin-bottom: 4px; padding: 6px; 
      border-radius: 5px; cursor: pointer; display: block; 
      background: #f8fafc; border: 1px solid #e2e8f0;
    }
    .stop:hover { background: #e2e8f0; }
    .stop .num { font-weight: bold; color: #64748b; font-size: 0.75rem; }
    .stop .details { margin-top: 1px; }
    .stop .time { font-weight: 600; color: #1e293b; }
    .stop .transport { color: #64748b; font-size: 0.7rem; }
    
    #full-route-btn {
      position: fixed; bottom: 20px; right: 20px; z-index: 1000; 
      background: linear-gradient(135deg, #0056b3, #007cba); color: white; 
      border: none; padding: 12px 16px; border-radius: 25px; cursor: pointer; 
      font-weight: 600; font-size: 0.9rem; box-shadow: 0 4px 16px rgba(0,86,179,0.4);
    }
    
    /* DESKTOP */
    @media (min-width: 768px) {
      .container { flex-direction: row; }
      #sidebar { max-height: none; min-height: auto; width: 380px; border-bottom: none; border-right: 1px solid #e0e6ed; }
      #menu-toggle, #close-sidebar { display: none; }
    }
    
    /* VERTICALE ESTREMO */
    @media (max-height: 600px) and (orientation: portrait) {
      #sidebar { max-height: 30vh; min-height: 30vh; }
      #map { min-height: 70vh; }
    }
    
    .custom-icon { background: transparent !important; border: none !important; }
    .icon-club, .icon-bar, .icon-hotel { font-size: 16px; }
  </style>
</head>
<body>
  <button id="menu-toggle" title="Apri Menu"><i class="fas fa-bars"></i></button>
  <button id="full-route-btn" title="Percorso Completo">üß≠ Completo</button>
  
  <div class="container">
    <div id="sidebar">
      <button id="close-sidebar" title="Chiudi Menu">‚úï</button>
      <h2>üá¨üáß Londra Itinerario</h2>
      
      <div class="day day-Venerdi" data-day="Venerd√¨">
        <h3>üóìÔ∏è Venerd√¨: East End</h3>
        <div class="stop" data-coords="51.5246, -0.0797"><span class="num">1.</span><div class="details"><span class="time">14:00</span> ibis Shoreditch <span class="transport">(Stansted Express)</span></div></div>
        <div class="stop" data-coords="51.5194, -0.0727"><span class="num">2.</span><div class="details"><span class="time">14:30</span> Spitalfields Market <span class="transport">(5 min)</span></div></div>
        <div class="stop" data-coords="51.5115, -0.0837"><span class="num">3.</span><div class="details"><span class="time">16:00</span> Sky Garden <span class="transport">(10 min)</span></div></div>
        <div class="stop" data-coords="51.5081, -0.0759"><span class="num">4.</span><div class="details"><span class="time">18:00</span> Tower Bridge <span class="transport">(10 min)</span></div></div>
      </div>

      <div class="day day-Sabato" data-day="Sabato">
        <h3>üóìÔ∏è Sabato: Royal & Arts</h3>
        <div class="stop" data-coords="51.5034, -0.1384"><span class="num">1.</span><div class="details"><span class="time">09:30</span> Buckingham Palace <span class="transport">(Metro 20 min)</span></div></div>
        <div class="stop" data-coords="51.4995, -0.1270"><span class="num">2.</span><div class="details"><span class="time">11:00</span> Big Ben <span class="transport">(10 min)</span></div></div>
        <div class="stop" data-coords="51.5033, -0.1196"><span class="num">3.</span><div class="details"><span class="time">12:30</span> London Eye</div></div>
        <div class="stop" data-coords="51.5074, -0.1280"><span class="num">4.</span><div class="details"><span class="time">15:30</span> National Gallery ‚òÖ</div></div>
        <div class="stop" data-coords="51.5101, -0.1360"><span class="num">5.</span><div class="details"><span class="time">17:30</span> Piccadilly</div></div>
      </div>

      <div class="day day-Domenica" data-day="Domenica">
        <h3>üóìÔ∏è Domenica: History</h3>
        <div class="stop" data-coords="51.5194, -0.1270"><span class="num">1.</span><div class="details"><span class="time">09:30</span> British Museum</div></div>
        <div class="stop" data-coords="51.5138, -0.0984"><span class="num">2.</span><div class="details"><span class="time">12:30</span> St. Paul's</div></div>
        <div class="stop" data-coords="51.5050, -0.0955"><span class="num">3.</span><div class="details"><span class="time">13:30</span> Borough Market</div></div>
        <div class="stop" data-coords="51.5074, -0.1196"><span class="num">4.</span><div class="details"><span class="time">15:00</span> Tate Modern</div></div>
        <div class="stop" data-coords="51.5100, -0.0900"><span class="num">5.</span><div class="details"><span class="time">16:30</span> Queen's Walk</div></div>
      </div>

      <div class="day day-Lunedi" data-day="Luned√¨">
        <h3>üóìÔ∏è Luned√¨: Rientro</h3>
        <div class="stop" data-coords="51.5235, -0.0740"><span class="num">1.</span><div class="details"><span class="time">09:30</span> Brick Lane</div></div>
        <div class="stop" data-coords="51.5179, -0.0811"><span class="num">2.</span><div class="details"><span class="time">11:30</span> Stansted Express</div></div>
      </div>
    </div>
    
    <div id="map"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
  <script>
    const map = L.map('map').setView([51.515, -0.12], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap'
    }).addTo(map);

    // ‚úÖ SIDEBAR MOBILE CONTROL
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('menu-toggle');
    const closeSidebar = document.getElementById('close-sidebar');
    
    menuToggle.addEventListener('click', () => {
      sidebar.style.maxHeight = '70vh';
      sidebar.scrollTop = 0;
    });
    
    closeSidebar.addEventListener('click', () => {
      sidebar.style.maxHeight = '35vh';
    });

    // MARKERS E PERCORSI (stesso codice precedente)
    const touristMarkers = L.featureGroup();
    const colors = {'Venerd√¨': '#0056b3', 'Sabato': '#e65100', 'Domenica': '#2e7d32', 'Luned√¨': '#6a1b9a'};
    
    const createDailyIcon = (color) => L.divIcon({
      html: `<div style="background-color:${color};width:12px;height:12px;border-radius:50%;border:2px solid white;"></div>`,
      iconSize: [20, 20], iconAnchor: [10, 10]
    });

    const stops = [
      { name: 'ibis Shoreditch', coords: [51.5246, -0.0797], day: 'Venerd√¨', color: colors['Venerd√¨'] },
      { name: 'Spitalfields', coords: [51.5194, -0.0727], day: 'Venerd√¨', color: colors['Venerd√¨'] },
      { name: 'Sky Garden', coords: [51.5115, -0.0837], day: 'Venerd√¨', color: colors['Venerd√¨'] },
      { name: 'Tower Bridge', coords: [51.5081, -0.0759], day: 'Venerd√¨', color: colors['Venerd√¨'] },
      { name: 'Buckingham', coords: [51.5034, -0.1384], day: 'Sabato', color: colors['Sabato'] },
      { name: 'Big Ben', coords: [51.4995, -0.1270], day: 'Sabato', color: colors['Sabato'] },
      { name: 'London Eye', coords: [51.5033, -0.1196], day: 'Sabato', color: colors['Sabato'] },
      { name: 'National Gallery', coords: [51.5074, -0.1280], day: 'Sabato', color: colors['Sabato'] },
      { name: 'Piccadilly', coords: [51.5101, -0.1360], day: 'Sabato', color: colors['Sabato'] },
      { name: 'British Museum', coords: [51.5194, -0.1270], day: 'Domenica', color: colors['Domenica'] },
      { name: 'St. Paul\'s', coords: [51.5138, -0.0984], day: 'Domenica', color: colors['Domenica'] },
      { name: 'Borough Market', coords: [51.5050, -0.0955], day: 'Domenica', color: colors['Domenica'] },
      { name: 'Tate Modern', coords: [51.5074, -0.1196], day: 'Domenica', color: colors['Domenica'] },
      { name: 'Queen\'s Walk', coords: [51.5100, -0.0900], day: 'Domenica', color: colors['Domenica'] },
      { name: 'Brick Lane', coords: [51.5235, -0.0740], day: 'Luned√¨', color: colors['Luned√¨'] },
      { name: 'Stansted Express', coords: [51.5179, -0.0811], day: 'Luned√¨', color: colors['Luned√¨'] }
    ];

    stops.forEach(stop => {
      L.marker(stop.coords, { icon: createDailyIcon(stop.color) })
        .bindPopup(`<b>${stop.name}</b><br><span style="color:${stop.color}">Giorno: ${stop.day}</span>`)
        .addTo(touristMarkers);
    });
    touristMarkers.addTo(map);

    // PERCORSI
    let currentRoute = null;
    const stopsByDay = {};
    document.querySelectorAll('.day').forEach(dayDiv => {
      const dayName = dayDiv.getAttribute('data-day');
      stopsByDay[dayName] = [];
      dayDiv.querySelectorAll('.stop[data-coords]').forEach(stop => {
        const [lat, lng] = stop.getAttribute('data-coords').split(',').map(parseFloat);
        stopsByDay[dayName].push([lat, lng]);
      });
    });

    function createRoute(waypoints, color) {
      if (currentRoute) map.removeControl(currentRoute);
      currentRoute = L.Routing.control({
        waypoints: waypoints.map(w => L.latLng(w[0], w[1])),
        show: false,
        lineOptions: { styles: [{color, opacity: 0.8, weight: 6}] },
        createMarker: () => null,
        router: L.Routing.osrmv1({ profile: 'foot' })
      }).addTo(map);
      map.fitBounds(L.latLngBounds(waypoints.map(w => L.latLng(w[0], w[1]))));
    }

    document.querySelectorAll('.day').forEach(day => {
      day.addEventListener('click', e => {
        if (e.target.closest('.stop')) return;
        const dayName = day.dataset.day;
        createRoute(stopsByDay[dayName], colors[dayName]);
      });
    });

    document.getElementById('full-route-btn').onclick = () => {
      const allWaypoints = [];
      Object.values(stopsByDay).forEach(dayWaypoints => allWaypoints.push(...dayWaypoints));
      createRoute(allWaypoints, '#ff6b35');
    };

    document.querySelectorAll('.stop[data-coords]').forEach(stop => {
      stop.onclick = (e) => {
        e.stopPropagation();
        const [lat, lng] = stop.dataset.coords.split(',').map(parseFloat);
        map.flyTo([lat, lng], 16);
      };
    });
  </script>
</body>
</html>

